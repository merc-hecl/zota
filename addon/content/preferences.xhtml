<linkset>
  <html:link rel="localization" href="__addonRef__-preferences.ftl" />
</linkset>
<groupbox
  onload="Zotero.__addonInstance__.hooks.onPrefsEvent('load', { window })"
  onunload="Zotero.__addonInstance__.hooks.onPrefsEvent('unload', { window })"
>
  <!-- Main layout: Single panel for API configuration -->
  <vbox flex="1" style="min-height: 400px; padding: 16px">
    <!-- API Configuration Panel -->
    <vbox id="pref-panel-apikey" class="provider-panel">
      <label
        id="pref-provider-title"
        data-l10n-id="pref-generic-provider-title"
        style="font-size: 16px; font-weight: bold; margin-bottom: 8px"
      ></label>
      <label
        id="pref-provider-description"
        data-l10n-id="pref-generic-provider-desc"
        style="margin-bottom: 12px; opacity: 0.7"
      ></label>

      <!-- Base URL (Endpoint) Dropdown -->
      <hbox align="center" style="margin-bottom: 8px">
        <label
          for="pref-provider-baseurl"
          data-l10n-id="pref-base-url"
          style="width: 70px; text-align: right"
        ></label>
        <menulist
          id="pref-provider-baseurl"
          style="flex: 1; margin-left: 8px; min-width: 150px"
          editable="true"
        >
          <menupopup id="pref-provider-baseurl-popup">
            <!-- Endpoints populated by JS -->
          </menupopup>
        </menulist>
      </hbox>

      <!-- API Key Dropdown -->
      <hbox align="center" style="margin-bottom: 8px">
        <label
          for="pref-provider-apikey"
          data-l10n-id="pref-api-key"
          style="width: 70px; text-align: right"
        ></label>
        <menulist
          id="pref-provider-apikey"
          style="flex: 1; margin-left: 8px; min-width: 150px"
          editable="true"
        >
          <menupopup id="pref-provider-apikey-popup">
            <!-- API keys populated by JS -->
          </menupopup>
        </menulist>
        <button
          id="pref-toggle-apikey"
          data-l10n-id="pref-show-key"
          style="margin-left: 8px; text-align: center"
          pack="center"
        ></button>
      </hbox>

      <!-- Model Selection -->
      <hbox align="center" style="margin-bottom: 8px">
        <label
          for="pref-provider-model"
          data-l10n-id="pref-model"
          style="width: 70px; text-align: right"
        ></label>
        <menulist
          id="pref-provider-model"
          style="flex: 1; margin-left: 8px; min-width: 120px"
        >
          <menupopup id="pref-provider-model-popup">
            <!-- Models populated by JS -->
          </menupopup>
        </menulist>
        <button
          id="pref-refresh-models"
          data-l10n-id="pref-refresh-models"
          style="margin-left: 8px; text-align: center"
          pack="center"
        ></button>
      </hbox>

      <!-- Model List -->
      <vbox style="margin-top: 12px; margin-bottom: 8px">
        <hbox align="center" style="margin-bottom: 8px">
          <label
            data-l10n-id="pref-model-list"
            style="width: 70px; text-align: right; font-weight: bold"
          ></label>
          <button
            id="pref-add-model-btn"
            data-l10n-id="pref-add-model"
            style="margin-left: 8px; text-align: center"
            pack="center"
          ></button>
        </hbox>
        <vbox
          id="pref-model-list"
          style="
            margin-left: 78px;
            max-height: 120px;
            overflow-y: auto;
            border: 1px solid var(--color-border, #ddd);
            border-radius: 4px;
            padding: 4px;
          "
        >
          <!-- Model list populated by JS -->
        </vbox>
      </vbox>

      <!-- Advanced Options (Collapsible) -->
      <html:details open="true" style="margin-top: 12px; margin-bottom: 12px">
        <html:summary
          data-l10n-id="pref-advanced-options"
          style="cursor: pointer; font-weight: bold; margin-bottom: 8px"
        ></html:summary>

        <!-- Max Tokens -->
        <hbox align="center" style="margin-bottom: 8px; margin-left: 12px">
          <label
            for="pref-provider-maxtokens"
            data-l10n-id="pref-max-tokens"
            style="width: 70px; text-align: right"
          ></label>
          <html:input
            type="number"
            id="pref-provider-maxtokens"
            style="width: 100px; margin-left: 8px"
          ></html:input>
          <label
            data-l10n-id="pref-max-tokens-hint"
            style="margin-left: 8px; opacity: 0.6; font-size: 12px"
          ></label>
        </hbox>

        <!-- Temperature -->
        <hbox align="center" style="margin-bottom: 8px; margin-left: 12px">
          <label
            for="pref-provider-temperature"
            data-l10n-id="pref-temperature"
            style="width: 70px; text-align: right"
          ></label>
          <html:input
            type="number"
            id="pref-provider-temperature"
            style="width: 80px; margin-left: 8px"
            min="0"
            max="2"
            step="0.1"
          ></html:input>
        </hbox>

        <!-- PDF Max Chars -->
        <hbox align="center" style="margin-bottom: 8px; margin-left: 12px">
          <label
            for="pref-provider-pdfmaxchars"
            data-l10n-id="pref-pdf-max-chars"
            style="width: 70px; text-align: right"
          ></label>
          <html:input
            type="number"
            id="pref-provider-pdfmaxchars"
            style="width: 100px; margin-left: 8px"
          ></html:input>
          <label
            data-l10n-id="pref-pdf-max-chars-hint"
            style="margin-left: 8px; opacity: 0.6; font-size: 12px"
          ></label>
        </hbox>

        <!-- System Prompt -->
        <hbox align="start" style="margin-bottom: 8px; margin-left: 12px">
          <label
            for="pref-provider-systemprompt"
            data-l10n-id="pref-system-prompt"
            style="width: 70px; text-align: right; margin-top: 4px"
          ></label>
          <html:textarea
            id="pref-provider-systemprompt"
            style="flex: 1; height: 60px; margin-left: 8px; min-width: 200px"
          ></html:textarea>
        </hbox>
      </html:details>

      <!-- Test Connection -->
      <hbox align="center" style="margin-top: 16px">
        <button
          id="pref-test-connection"
          data-l10n-id="pref-test-connection"
          style="text-align: center"
          pack="center"
        ></button>
        <label id="pref-test-result" style="margin-left: 12px"></label>
      </hbox>
    </vbox>
  </vbox>
</groupbox>
